name: create-pr-into-prod-from-master-on-pr-merge-into-master
on:
  pull_request:
    branches:
      - master
    types:
      - closed
jobs:
  if_merged_and_target_is_master:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
    - name: Create Pull Request Into Prod
      if: ${{ github.base_ref == 'master' }}
      uses: actions/github-script@v6
      with:
        script: |
          const { repo, owner } = context.repo;

          const currentPRIntoProd = await github.rest.pulls.list({
            owner,
            repo,
            state: 'open',
            head: '${{ github.base_ref }}',
            base: 'production'
          })

          if (currentPRIntoProd && currentPRIntoProd.data.length == 0) {
            const result = await github.rest.pulls.create({
              title: 'Auto Generated PR from master',
              owner,
              repo,
              head: '${{ github.base_ref }}',
              base: 'production',
              body: [
                'This PR is auto-generated by',
                '[This GitHub Action](https://github.com/actions/github-script).'
              ].join('\n')
            });
            console.log(result);
            console.log("Created new PR");
          } else {
            console.log("Succesfully didn't create new PR");
          }
